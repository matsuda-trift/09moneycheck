# #004 診断ロジック実装

## 概要
キャッシュフロー診断の計算ロジックとスコアリング機能を実装する

## タスク

### 診断ロジック基盤
- [x] `lib/diagnose.ts` を作成
- [x] ファイルヘッダー記載

### 計算関数実装
- [x] `calculateTotals()` 実装（総収入、総支出計算）
- [x] `calculateRatios()` 実装（各種比率計算）
  - 貯蓄率 = (総収入 - 総支出) / 総収入
  - 固定費比率 = 固定費 / 総収入
  - 無駄遣い比率 = 無駄遣い / 総収入
  - 自己投資比率 = 自己投資 / 総収入
  - 受動収入比率 = 受動収入 / 総収入

### スコアリング実装
- [x] `calculateScores()` 実装（項目別点数計算）
  - 収支バランス: 30点満点
  - 固定費比率: 25点満点
  - 資産負債: 18点満点
  - 受動収入: 12点満点
  - 自己投資: 10点満点
  - 無駄遣い: 5点満点
- [x] `getRank()` 実装（ランク判定）
  - S+ (95-100), S (85-94), A (75-84), B (65-74)
  - C (55-64), D (45-54), E (35-44), F (0-34)

### メイン診断関数
- [x] `diagnose()` 実装（全体統合）
- [x] `DiagnoseResult` 型に準拠した返却値

## スコア計算詳細

### 収支バランス（30点）
```typescript
貯蓄率 >= 30% → 30点
貯蓄率 >= 20% → 26点
貯蓄率 >= 10% → 18点
貯蓄率 < 10% → 10点
```

### 固定費比率（25点）
```typescript
比率 <= 25% → 25点
比率 <= 30% → 20点
比率 <= 35% → 15点
比率 > 35% → 10点
```

### 資産負債（18点）
```typescript
資産 >= 負債 × 5 → 18点
資産 >= 負債 × 3 → 15点
資産 >= 負債 × 2 → 12点
資産 < 負債 × 2 → 8点
```

### 受動収入（12点）
```typescript
比率 >= 30% → 12点
比率 >= 20% → 10点
比率 >= 10% → 7点
比率 < 10% → 4点
```

### 自己投資（10点）
```typescript
比率 >= 15% → 10点
比率 >= 10% → 8点
比率 >= 7% → 6点
比率 < 7% → 3点
```

### 無駄遣い（5点）
```typescript
比率 <= 10% → 5点
比率 <= 15% → 4点
比率 <= 20% → 3点
比率 > 20% → 2点
```

## 受け入れ基準
- [x] 全ての計算が正確に動作する
- [x] `DiagnoseResult` 型に準拠している
- [x] エッジケース処理（0除算など）が実装されている
- [x] 100点満点でスコアが計算される
- [x] ランク判定が正しく動作する
- [x] `any` 型を使用していない
- [x] 300行以内（166行）

## テストケース
```typescript
// 例: 理想的なケース
入力: {
  laborIncome: 300000,
  passiveIncome: 100000,
  fixedCost: 100000,
  waste: 40000,
  selfInvestment: 60000,
  asset: 5000000,
  debt: 500000
}
期待: スコア90点以上、ランクS以上
```

## 関連ファイル
- `lib/diagnose.ts`
- `types/index.ts`
- `lib/sessionStorage.ts`

## 注意事項
- 投資助言を含まない（計算のみ）
- 0除算エラーハンドリング必須
- ファイルヘッダー必須
